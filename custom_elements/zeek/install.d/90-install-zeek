#!/bin/bash

set -e

echo "Starting Zeek installation script..."

# Add Zeek's repository and key for Ubuntu 22.04
echo 'Adding Zeek repository...'
echo 'deb http://download.opensuse.org/repositories/security:/zeek/xUbuntu_22.04/ /' | tee /etc/apt/sources.list.d/security:zeek.list

echo 'Adding Zeek repository key...'
curl -fsSL https://download.opensuse.org/repositories/security:/zeek/xUbuntu_22.04/Release.key | gpg --dearmor | tee /etc/apt/trusted.gpg.d/security_zeek.gpg > /dev/null

echo 'Updating package list...'
apt update

# Install Zeek 7.0.1
echo 'Installing Zeek...'
apt install -y zeek-7.0.1

# Initialize and configure Zeek with zeekctl
echo 'Initializing Zeek with zeekctl...'
zeekctl deploy

# Zeek does not use a native systemd service, so we rely on zeekctl
# to manage Zeek's lifecycle.

# Cleanup
echo 'Cleaning up...'
apt-get clean

echo "Zeek installation completed."
